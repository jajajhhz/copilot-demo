USB Webcam HTTP Driver (UVC to HTTP)

This driver connects to a USB webcam using UVC (via OpenCV) and exposes an HTTP interface for streaming MJPEG video and capturing single frames.

Exposed HTTP APIs
- GET /stream
  - Returns a continuous multipart MJPEG stream (Content-Type: multipart/x-mixed-replace; boundary=frame)
  - Close the client connection to stop receiving frames
- GET /frame
  - Returns a single snapshot image
  - Uses image/jpeg by default; if the client sends Accept: image/png, it returns PNG

Environment Variables
- HTTP_HOST: HTTP server bind address (default: 0.0.0.0)
- HTTP_PORT: HTTP server port (default: 8000)
- CAM_DEVICE: Camera source; integer index like 0 or OS device path like /dev/video0 (default: 0)
- CAM_WIDTH: Requested capture width (default: 640)
- CAM_HEIGHT: Requested capture height (default: 480)
- CAM_FPS: Requested capture frames per second (default: 30)
- JPEG_QUALITY: JPEG quality 1-100 for streaming and default snapshots (default: 80)
- READ_TIMEOUT_SEC: Time without good frames before reconnect (default: 5.0)
- RECONNECT_BACKOFF_INITIAL_MS: Initial reconnect backoff in milliseconds (default: 500)
- RECONNECT_BACKOFF_MAX_MS: Maximum reconnect backoff in milliseconds (default: 10000)
- READ_ERROR_THRESHOLD: Number of consecutive read errors before reconnect (default: 30)
- LOG_LEVEL: Logging level (DEBUG, INFO, WARNING, ERROR) (default: INFO)

Install
- Python 3.8+
- Install dependencies:
  - pip install -r requirements.txt

Run
- Set any needed environment variables and start the driver:
  - HTTP_PORT=8000 CAM_DEVICE=0 python driver.py

Quick Test
- Single frame (JPEG):
  - curl -v http://127.0.0.1:8000/frame -o frame.jpg
- Single frame (PNG):
  - curl -H "Accept: image/png" http://127.0.0.1:8000/frame -o frame.png
- MJPEG stream (view in browser):
  - Open http://127.0.0.1:8000/stream in a browser
- MJPEG stream (with curl):
  - curl -N http://127.0.0.1:8000/stream -o stream.mjpeg

Notes
- The driver continuously grabs frames in the background and maintains a thread-safe latest-frame buffer for quick responses.
- If the camera disconnects or stops delivering frames, the driver will attempt to reconnect with exponential backoff.
- Graceful shutdown: send SIGINT (Ctrl+C) or SIGTERM; the driver stops the background capture thread and HTTP server cleanly.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
